# Домашнее задание №5

Домашнее задание предназначено для изучения базы данных SQL через систему управления sqlite3 на языке go.

# Задание

Необходимо написать библиотеку для работы с базой данных перелётов, которая имеет следующую структуру:

![Структура базы данных](/readme/aero.png)

 - **Plane** - Хранит информацию о самолётах
 - **Passenger** - Хранит информацию о всех пассажирах
 - **Company** - Хранит информацию о всех самолётах
 - **Trip** - Хранит информацию о запланированных перелётах
 - **Taken** - Хранит информацию о занятых местах в самолёте в определённой поездке

Необходимо реализовать функции открытия и закрытия структуры **AeroDB** и методы этой структуры, так чтобы они соответствовали интерфейсу:

```go
type Sqlite3DB interface {
    OpenDB(fname string) (error)
    CloseDB() (error) 
    PlanTrip(trip Trip) (TripID int, error)
    EndTrip(tripID int) (error)
    GetTrips(from, to string) ([]Trip, error)
    GetAllTrips() ([]Trip, error)
    TakeSeat(tripID int, passenger string, seat int) (error)
    GetFreeSeats(tripID int) ([]int, error)
    AddCompany(name string) (error)
    DelCompany(name string) (error)
    AddPlane(name, companyName string, seats int) (error)
    DelPlane(name string) (error)
    AddPassenger(name string) (error)
}


type Trip struct {
    id int
    company, plane int
    timeOut, timeIn time.Time
    townOut, townIn int
}
```

# Ошибки

```go
import (
	"errors"
)


var (
    ErrNotOpened    = errors.New("database is not opened")
    ErrAlreadyIn    = errors.New("element already in database")
    ErrNotFound     = errors.New("element not found")
    ErrEmpty        = errors.New("empty result")
    ErrSeatRange    = errors.New("incorrect seat number") 
    ErrAlreadyTaken = errors.New("seat already taken")   
    ErrFile         = errors.New("cannot open the file")
    ErrDBFormat     = errors.New("not correct format of database")
    ErrIncorectTime = errors.New("incorrect time period")
    
    // На случай неконтролируемых ошибок работы с базой данных
    ErrDB           = errors.New("unknown mistakes with database")
) 
```

# Описание методов и функций

#### Метод `OpenDB`

`Вход:` Название файла базы данных.

`Выход:` ошибка(или nil)

Метод подготавливает структуру к операциям над базой, открывая файл sqlite3 и выполняя дополнительные операции, если в вашей структуре есть что-то еще, а также проверяет корректность формата базы данных.

`Возможные ошибки:`
**ErrFile** - Если не удалось открыть или найти файл
**ErrDBFormat** - Если задан некорректный формат у базы данных

#### Метод `CloseDB`

`Вход:`

`Выход:` Ошибка(или nil)

Метод завершает работу с базой данных.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта

#### Метод `PlanTrip`

`Вход:` Названия компании и самолета, время вылета и прибытия, места начала и прибытия.

`Выход:` Id созданной поездки, ошибка(или nil)

Добавляет в базу данных новую поездку с заданной информацией, если самолёта или компании с заданными именами нет или указан некорретные времена, то вернуть ошибку. Если указанное Id уже занято, то задаётся первое доступное.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNotFound** - Если не найдена компания, или самолёт
**ErrIncorrectTime** - Если подан некорректный промежуток времени timeOut timeIn(timeOut < timeIn).

#### Метод `EndTrip`

`Вход:` ID поездки

`Выход:` Ошибка(или nil)

Метод завершает выбранную поездку, удаляя ее из базы данных, при этом также из Taken удаляются места, связанные с этой поездкой.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNotFound** - Если не существует введённого id поездки

#### Метод `GetTrips`

`Вход:` Место начала и место прибытия

`Выход:` Слайс поездок, ошибка(или nil)

Метод считывает все поездки из базы данных которые начинаются в from, а заканчивается в to и возвращает их в виде слайса. В случае пустого слайса вернуть ошибку.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrEmpty** - В случае, если не было найдено подходящих поездок

#### Метод `GetAllTrips`

`Вход:` 

`Выход:` Слайс поездок, ошибка(или nil)

Метод считывает все поездки из базы данных и возвращает их в виде слайса.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrEmpty** - В случае, если нет ни одной поездки

#### Метод `TakeSeat`

`Вход:` ID поездки, информация о пассажире, номер места

`Выход:` Ошибка(или nil)

Метод заносит информацию о том, что место в поездке занято некоторым пассажиром. Если пассажира нет в базе данных Passenger, то метод добавляет его. Если место занято, его нет в самолете или не существует поездки, возвращается ошибка.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNotFound** - Если не найдены поездка или пассажир
**ErrSeatRange** - Если введённый номер места некорректен(меньше 0, или >количества мест в самолёте)
**ErrAlreadyTaken** - Если введённое место уже занято 

#### Метод `GetFreeSeats`

`Вход:` ID поездки

`Выход:` Слайс номеров свободных мест, ошибка(или nil)

Метод ищет свободные места в поездке и возвращает их слайс.

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNotFound** - Если не найдена поездка
**ErrEmpty** - В случае, если все места заняты

#### Метод `AddCompany`

`Вход:` Название компании

`Выход:` Ошибка(или nil)

Метод добавляет новую компанию в базу данных. Если компания уже есть в базе данных, то возвращает ошибку

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrAlreadyIn** - Если компания с таким именем уже есть в базе

#### Метод `DelCompany`

`Вход:` Название компании

`Выход:` Ошибка(или nil)

Метод удаляет компанию из базы данных. Если компания нет в базе данных, то возвращает ошибку

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNorFound** - Если компании с таким именем нет в базе данных

#### Метод `AddPlane`

`Вход:` Название самолета, название компании, количество мест в самолёте

`Выход:` Ошибка(или nil)

Метод добавляет новый самолёт в базу данных. Если самолёт уже есть в базе, введенной компании нет, или некорректное количество мест(<= 0), то возвращает ошибку

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrAlreadyIn** - Если самолёт с таким именем уже есть в базе

#### Метод `Delplane`

`Вход:` Название самолёта

`Выход:` Ошибка(или nil)

Метод удаляет самолёт из базы данных. Если самолёта нет в базе данных, то возвращает ошибку

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrNorFound** - Если самолёта с таким названием нет в базе данных

#### Метод `AddPassenger`

`Вход:` Имя

`Выход:` Ошибка(или nil)

`Возможные ошибки:`
**ErrNotOpened** - Если не была открыта база данных, или уже была закрыта
**ErrAlreadyIn** - Если пассажир с таким именем уже есть в базе
